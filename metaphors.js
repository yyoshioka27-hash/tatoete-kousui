// たとえて降水確率：例えデータ定義ファイル（新仕様）
//
// 仕様：0,10,20,...,100% の 11段階
// 各段階 3ネタ（合計33）
// モード分けはしない（雑学/お笑いの境界は作らない）

(function () {
  // =========================
  // 11段階×3ネタ：確定版
  // =========================
  window.NETA = {
    0: [
      "円周率を暗記で1000桁言える人はほぼいない",
      "文系の人が数学の未解決問題を解決する確率",
      "拾った宝くじで大金持ちになる確率",
    ],
    10: [
      "会議が1分で終わる確率",
      "全員が資料を事前に読んでいる確率",
      "天気予報より自分を信じたい日。",
    ],
    20: [
      "たまにはある感覚が約20%",
      "降らない前提で、言い訳を考えている。",
      "空をみたら負けた気分",
    ],
    30: [
      "傘を持って出かけても出番がないことが多そう",
      "世界の陸地の約3割はロシア",
      "計画通りに1日が終わる確率",
    ],
    40: [
      "あなたの判断力が試される",
      "1980年代の阪神の勝率",
      "まだ決めきれない。油断は禁物",
    ],
    50: [
      "今日は濡れなきゃOK",
      "今日は空とにらめっこです",
      "運に任せる覚悟はできましたか",
    ],
    60: [
      "今日は自分の強運を信じたい",
      "ほぼ、あきらめかけている自分がいる",
      "諦めたら、負けです",
    ],
    70: [
      "まじめな人が濡れない可能性大",
      "諦めるな、強運を信じよう",
      "傘を持たずに出かけて濡れなかったらあなたの勝",
    ],
    80: [
      "本当はもうあきらめている",
      "今は降っていない。それだけだ。",
      "まだ大丈夫、が一番危ない。",
    ],
    90: [
      "雨が多い。だが、濡れると決まったわけじゃない。",
      "覚悟は必要。諦めは不要。",
      "傘を持たずに出かけるあなたはかっこいい",
    ],
    100: [
      "外は雨。だけど、あなたは雨も似合う。",
      "外は雨。その分、何かいいことがありそうな予感。",
      "天気は悪い。せめて心だけは晴天で。",
    ],
  };

  // =========================
// モード別（雑学だけ追加）
// 既存の window.NETA は unified として残す
// =========================
window.NETA_TRIVIA = {
  0:  ["（雑学）宝くじ1等を当て続ける確率はほぼ0%", "（雑学）稀少事象レベル", "（雑学）天文学的に低い"],
  10: ["（雑学）10人に1人くらいの確率", "（雑学）当たったらラッキー", "（雑学）気にするほどではない"],
  20: ["（雑学）世界人口の 約20%が中国語話者", "（雑学）南半球の陸地は全体の約3割", "（雑学）1か月に1冊以上本を読む人は約2割"],
  30: ["（雑学）人は人生の 約30%を睡眠", "（雑学）世界の陸地の約3割はロシア", "（雑学）運動習慣がある人の割合30%"],
  40: ["（雑学）半分手前", "（雑学）注意は必要", "（雑学）傘の検討圏内"],
  50: ["（雑学）コイントスで表が出る確率とほぼ同じです", "（雑学）世界人口の 半数以上が2言語以上を使用", "（雑学）迷ったら傘"],
  60: ["（雑学）世界人口の約6割はアジアに集中", "（雑学）日本の国土の 約67%は森林", "（雑学）人体の 約60%は水分"],
  70: ["（雑学）地球表面の 約71%は海", "（雑学）日本の 国土の約7割は山", "（雑学）勝率7割は 歴史的シーズン"],
  80: ["（雑学）地球の大気の 約78%は窒素", "（雑学）世界の国の 約8割で英語教育が行われている", "（雑学）雨前提で動く"],
  90: ["（雑学）日本人の 9割以上がスマホを所有", "（雑学）覆らない", "（雑学）傘は必須"],
  100:["（雑学）確実", "（雑学）例外なし", "（雑学）100%は100%"]
};

  // =========================
  // 0/10/.../100 に丸める
  // =========================
  window.bucket10 = function (p) {
    p = Math.max(0, Math.min(100, Number(p)));
    const b = Math.round(p / 10) * 10;
    return Math.max(0, Math.min(100, b));
  };

  // =========================
  // 直前回避つきで1つ選ぶ
  // =========================
  let _lastSeed = null;

  window.pickNeta = function (bucket) {
  const mode = getSelectedMode && getSelectedMode(); // trivia / fun
  const pool =
    mode === "trivia"
      ? (window.NETA_TRIVIA?.[bucket] ?? [])
      : (window.NETA?.[bucket] ?? []);


  // =========================
  // 互換：旧 metaphorDB を参照している場合のための最低限
  // （index側がまだ metaphorDB を使っていても壊れにくい）
  // =========================
  window.metaphorDB = window.metaphorDB || {};
  window.metaphorDB.unified = Object.keys(window.NETA).map((k) => {
    const min = Number(k);
    const max = Number(k);
    return { min, max, texts: window.NETA[min] };
  });

  // 旧キー参照があっても同じ配列が返るようにエイリアス
  window.metaphorDB.serious = window.metaphorDB.unified;
  window.metaphorDB.trivia = window.metaphorDB.unified;
  window.metaphorDB.fun = window.metaphorDB.unified;
  window.metaphorDB.normal = window.metaphorDB.unified;

  // =========================
  // 互換：旧 randomFact が呼ばれても落ちないように
  // =========================
  window.randomFact = function () {
    // 旧仕様の「統計ネタ」概念は廃止。代わりに50%帯から返す
    return (window.NETA[50] && window.NETA[50][0]) || "今日は濡れなきゃOK";
  };
})();
