// たとえて降水確率：例えデータ定義ファイル（新仕様）
//
// 仕様：0,10,20,...,100% の 11段階
// 各段階 3ネタ（合計33）
// モード分けはしない（雑学/お笑いの境界は作らない）
// 保険：metaphors.js が読み込まれていれば bucket10 を必ず定義する
window.bucket10 = window.bucket10 || function (p) {
  p = Math.max(0, Math.min(100, Number(p)));
  const b = Math.round(p / 10) * 10;
  return Math.max(0, Math.min(100, b));
};

(function () {
// =========================
// 雑学ネタ（trivia） 11段階×3
// =========================
window.NETA_TRIVIA = {
  0: [
    "日本の総人口に対して富士山に登ったことがある人の割合（体感ほぼ0%）",
    "一生のうちにオーロラを肉眼で見る確率（日本在住だとかなり低め）",
    "徒歩で日本一周を完走する確率",
  ],
  10: [
    "宝くじで高額当選する確率（現実は低い）",
    "世界の言語のうち母語話者が1億人を超える言語の割合（多くない）",
    "新年の目標を1年続ける確率（だいたいこの辺の気分）",
  ],
  20: [
    "人は人生の約3分の1を睡眠に使う（体感20〜30%）",
    "世界人口のうち東アジアに住む人の割合（ざっくり多め）",
    "1日にコーヒーを飲む人の割合（けっこう多い）",
  ],
  30: [
    "世界の陸地のうち森林が占める割合（ざっくりこの辺）",
    "1週間に運動をする人の割合（体感3割くらい）",
    "予定通りに一日が終わる確率（希望込み）",
  ],
  40: [
    "日本の国土のうち森林が占める割合（かなり高い）",
    "スマホの画面を1日1回以上拭く人の割合（案外少ない）",
    "1か月に1冊以上本を読む人の割合（体感4割くらい）",
  ],
  50: [
    "コイントスで表が出る確率",
    "雨具を持って行くか迷う日の確率",
    "『半分くらい当たる予感』の確率",
  ],
  60: [
    "人体の約6割は水分",
    "世界人口の約6割はアジアに住んでいる",
    "買った傘がすぐ壊れる確率（体感そこそこ）",
  ],
  70: [
    "地球表面の約7割は海",
    "日本の国土の約7割は山地",
    "『だいたい予想が当たる』感覚の確率",
  ],
  80: [
    "会議で同じ話が繰り返される確率（体感かなり高い）",
    "週末に疲れが出る確率",
    "提出直前に誤字を見つける確率",
  ],
  90: [
    "『とりあえず共有』のメールが届く確率",
    "何かしら予定変更が入る確率",
    "忘れた頃に雨が降る確率（気のせい）",
  ],
  100: [
    "今日が今日である確率",
    "月曜が来る確率",
    "濡れる未来が見える確率（ほぼ確）",
  ],
};

  // =========================
// モード別（雑学だけ追加）
// 既存の window.NETA は unified として残す
// =========================
window.NETA_TRIVIA = {
  0:  ["（雑学）宝くじ1等を当て続ける確率はほぼ0%", "（雑学）稀少事象レベル", "（雑学）天文学的に低い"],
  10: ["（雑学）10人に1人くらいの確率", "（雑学）当たったらラッキー", "（雑学）気にするほどではない"],
  20: ["（雑学）世界人口の 約20%が中国語話者", "（雑学）南半球の陸地は全体の約3割", "（雑学）1か月に1冊以上本を読む人は約2割"],
  30: ["（雑学）人は人生の 約30%を睡眠", "（雑学）世界の陸地の約3割はロシア", "（雑学）運動習慣がある人の割合30%"],
  40: ["（雑学）半分手前", "（雑学）注意は必要", "（雑学）傘の検討圏内"],
  50: ["（雑学）コイントスで表が出る確率とほぼ同じです", "（雑学）世界人口の 半数以上が2言語以上を使用", "（雑学）迷ったら傘"],
  60: ["（雑学）世界人口の約6割はアジアに集中", "（雑学）日本の国土の 約67%は森林", "（雑学）人体の 約60%は水分"],
  70: ["（雑学）地球表面の 約71%は海", "（雑学）日本の 国土の約7割は山", "（雑学）勝率7割は 歴史的シーズン"],
  80: ["（雑学）地球の大気の 約78%は窒素", "（雑学）世界の国の 約8割で英語教育が行われている", "（雑学）雨前提で動く"],
  90: ["（雑学）日本人の 9割以上がスマホを所有", "（雑学）覆らない", "（雑学）傘は必須"],
  100:["（雑学）確実", "（雑学）例外なし", "（雑学）100%は100%"]
};

  // =========================
  // 0/10/.../100 に丸める
  // =========================
  window.bucket10 = function (p) {
    p = Math.max(0, Math.min(100, Number(p)));
    const b = Math.round(p / 10) * 10;
    return Math.max(0, Math.min(100, b));
  };

  // =========================
  // 直前回避つきで1つ選ぶ
  // =========================
  let _lastSeed = null;

  window.pickNeta = function (bucket) {
  const mode = getSelectedMode && getSelectedMode(); // trivia / fun
  const pool =
    mode === "trivia"
      ? (window.NETA_TRIVIA?.[bucket] ?? [])
      : (window.NETA?.[bucket] ?? []);


  // =========================
  // 互換：旧 metaphorDB を参照している場合のための最低限
  // （index側がまだ metaphorDB を使っていても壊れにくい）
  // =========================
  window.metaphorDB = window.metaphorDB || {};
  window.metaphorDB.unified = Object.keys(window.NETA).map((k) => {
    const min = Number(k);
    const max = Number(k);
    return { min, max, texts: window.NETA[min] };
  });

  // 旧キー参照があっても同じ配列が返るようにエイリアス
  window.metaphorDB.serious = window.metaphorDB.unified;
  window.metaphorDB.trivia = window.metaphorDB.unified;
  window.metaphorDB.fun = window.metaphorDB.unified;
  window.metaphorDB.normal = window.metaphorDB.unified;

  // =========================
  // 互換：旧 randomFact が呼ばれても落ちないように
  // =========================
  window.randomFact = function () {
    // 旧仕様の「統計ネタ」概念は廃止。代わりに50%帯から返す
    return (window.NETA[50] && window.NETA[50][0]) || "今日は濡れなきゃOK";
  };
})();
