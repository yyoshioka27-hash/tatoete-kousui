// たとえて降水確率：例えデータ定義ファイル（新仕様）
//
// 仕様：0,10,20,...,100% の 11段階
// 各段階 3ネタ（合計33）
// モード分けはしない（雑学/お笑いの境界は作らない）

(function () {
  // =========================
  // 11段階×3ネタ：確定版
  // =========================
  window.NETA = {
    0: [
      "外出時に左右違う靴を履いてしまう確率",
      "一般の人が数学の未解決問題を解く確率",
      "拾った宝くじで大金持ちになる確率",
    ],
    10: [
      "会議が1分で終わる確率",
      "全員が資料を事前に読んでいる確率",
      "上司の説明が一発で理解できる確率",
    ],
    20: [
      "世界人口の約2割は中国語話者",
      "運動習慣がある人の割合",
      "新年の目標を1年守り切る人の割合",
    ],
    30: [
      "人は人生の約3分の1を睡眠に使う",
      "世界の陸地の約3割はロシア",
      "計画通りに1日が終わる確率",
    ],
    40: [
      "1か月に1冊以上本を読む人は約4割",
      "1980年代の阪神の勝率",
      "定時で帰れる日の確率",
    ],
    50: [
      "今日は濡れなきゃOK",
      "コイントスで表が出る確率",
      "半分くらい当たる予感の確率",
    ],
    60: [
      "世界人口の約6割はアジアに住んでいる",
      "世界で英語が通じる人は約6割",
      "人体の約6割は水分",
    ],
    70: [
      "地球表面の約7割は海",
      "日本の国土の約7割は山",
      "だいたい予想が当たる確率",
    ],
    80: [
      "会議で同じ話が繰り返される確率",
      "金曜に疲れを感じる確率",
      "資料に赤字が入る確率",
    ],
    90: [
      "「とりあえず共有」のメールが届く確率",
      "何かしら予定変更が入る確率",
      "忘れた頃に雨が降る確率",
    ],
    100: [
      "そらが悲しみの涙であふれている",
      "月曜が来る確率",
      "今日が今日である確率",
    ],
  };

  // =========================
// モード別（雑学だけ追加）
// 既存の window.NETA は unified として残す
// =========================
window.NETA_TRIVIA = {
  0:  ["（雑学）ほぼ起きないレベルの確率", "（雑学）稀少事象レベル", "（雑学）天文学的に低い"],
  10: ["（雑学）10人に1人くらいの確率", "（雑学）当たったらラッキー", "（雑学）気にするほどではない"],
  20: ["（雑学）5回に1回くらい", "（雑学）意外とある", "（雑学）油断すると当たる"],
  30: ["（雑学）3回に1回くらい", "（雑学）そこそこ現実的", "（雑学）あり得るライン"],
  40: ["（雑学）半分手前", "（雑学）注意は必要", "（雑学）傘の検討圏内"],
  50: ["（雑学）コイントス級", "（雑学）五分五分", "（雑学）迷ったら傘"],
  60: ["（雑学）やや高め", "（雑学）降る側が優勢", "（雑学）傘推奨"],
  70: ["（雑学）かなり高い", "（雑学）対策した方がいい", "（雑学）濡れる覚悟"],
  80: ["（雑学）ほぼ来る", "（雑学）回避は難しい", "（雑学）雨前提で動く"],
  90: ["（雑学）ほぼ確定", "（雑学）覆らない", "（雑学）傘は必須"],
  100:["（雑学）確実", "（雑学）例外なし", "（雑学）100%は100%"]
};

  // =========================
  // 0/10/.../100 に丸める
  // =========================
  window.bucket10 = function (p) {
    p = Math.max(0, Math.min(100, Number(p)));
    const b = Math.round(p / 10) * 10;
    return Math.max(0, Math.min(100, b));
  };

  // =========================
  // 直前回避つきで1つ選ぶ
  // =========================
  let _lastSeed = null;

  window.pickNeta = function (bucket) {
    const pool = window.NETA[bucket] ?? [];
    if (pool.length === 0) return "";
    let candidates = pool.filter((t) => t !== _lastSeed);
    if (candidates.length === 0) candidates = pool;
    const seed = candidates[Math.floor(Math.random() * candidates.length)];
    _lastSeed = seed;
    return seed;
  };

  // =========================
  // 互換：旧 metaphorDB を参照している場合のための最低限
  // （index側がまだ metaphorDB を使っていても壊れにくい）
  // =========================
  window.metaphorDB = window.metaphorDB || {};
  window.metaphorDB.unified = Object.keys(window.NETA).map((k) => {
    const min = Number(k);
    const max = Number(k);
    return { min, max, texts: window.NETA[min] };
  });

  // 旧キー参照があっても同じ配列が返るようにエイリアス
  window.metaphorDB.serious = window.metaphorDB.unified;
  window.metaphorDB.trivia = window.metaphorDB.unified;
  window.metaphorDB.fun = window.metaphorDB.unified;
  window.metaphorDB.normal = window.metaphorDB.unified;

  // =========================
  // 互換：旧 randomFact が呼ばれても落ちないように
  // =========================
  window.randomFact = function () {
    // 旧仕様の「統計ネタ」概念は廃止。代わりに50%帯から返す
    return (window.NETA[50] && window.NETA[50][0]) || "今日は濡れなきゃOK";
  };
})();
